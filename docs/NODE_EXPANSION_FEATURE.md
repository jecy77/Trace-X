# 노드 확장 기능 문서

## 개요

Ad-hoc 분석 페이지에 노드 확장 기능을 추가하여 사용자가 그래프에서 특정 노드를 클릭하여 해당 노드의 1-hop 거래를 추가로 로드할 수 있도록 구현했습니다.

## 주요 기능

### 1. 노드 확장 기능

- **기본 동작**: 노드를 클릭하면 해당 노드의 리스크 분석 결과를 표시
- **확장 버튼**: 타겟 주소가 아닌 노드의 경우 "이 노드 확장" 버튼이 표시됨
- **확장 방식**: 기존 그래프를 유지한 채 새로운 노드와 엣지만 추가 (병합 방식)
- **중복 방지**: 이미 존재하는 노드와 엣지는 자동으로 제외

### 2. 타겟 노드 변경

- 확장 버튼을 클릭하면 해당 노드가 새로운 타겟으로 설정됨
- 타겟 노드는 초록색 배경과 "TARGET" 태그로 표시됨
- 기존 타겟 노드는 일반 노드로 변경됨

### 3. 리스크 분석

#### 기본 분석 (기본값)

- **max_hops**: 1
- **analysis_type**: "basic"
- 빠른 응답 시간, 기본적인 리스크 평가

#### 심층분석 (선택적)

- **max_hops**: 3
- **analysis_type**: "advanced"
- 더 정확한 리스크 평가, 그래프 패턴 탐지 가능
- "심층분석 (3-hop, Advanced)" 버튼으로 활성화

### 4. 시각적 표시

- **확장 가능한 노드**: 보라색 테두리(`#667eea`)와 라벨 끝에 "→" 아이콘 표시
- **타겟 노드**: 초록색 배경, "TARGET" 태그, 더 큰 크기
- **확장된 노드**: `expandedNodes` Set으로 추적하여 중복 확장 방지

## 구현 세부사항

### 상태 관리

```typescript
const [expandedNodes, setExpandedNodes] = useState<Set<string>>(new Set());
const [isDeepAnalysis, setIsDeepAnalysis] = useState(false);
```

- `expandedNodes`: 확장된 노드 주소를 추적하는 Set
- `isDeepAnalysis`: 심층분석 여부를 추적하는 boolean

### 주요 함수

#### `handleExpandNodeAsTarget(nodeAddress: string)`

- 노드를 타겟으로 설정하고 1-hop 확장
- 기존 그래프에 새로운 노드와 엣지를 병합
- 타겟 노드 업데이트 (기존 타겟 → 일반 노드, 확장 노드 → 새 타겟)

#### `handleNodeClick(nodeAddress: string)`

- 노드 클릭 시 기본 분석 수행 (1-hop, basic)
- 심층분석 상태 리셋

## UI/UX 개선사항

### 버튼 배치

- 확장 버튼과 심층분석 버튼을 리스크 분석 결과 맨 아래에 배치
- 페이지 전체 색톤에 맞게 스타일 조정

### 색상 스키마

- 배경: `var(--neutral800, #060a1d)`
- 테두리: `var(--secondary200, #343b4f)`
- 텍스트: `var(--primary400, #aeb9e1)`
- 호버: `var(--secondary200, #343b4f)` 배경, `var(--primary500, #7c8dd8)` 테두리

## 사용 흐름

1. **주소 분석**: 주소를 입력하고 "분석하기" 클릭
2. **노드 클릭**: 그래프에서 노드를 클릭하여 기본 분석 결과 확인
3. **심층분석** (선택적): "심층분석 (3-hop, Advanced)" 버튼 클릭하여 더 정확한 분석 수행
4. **그래프 확장**: "이 노드 확장" 버튼 클릭하여 해당 노드의 1-hop 거래 추가
5. **반복**: 다른 노드를 클릭하여 추가 분석 및 확장 가능

## 변경된 파일

- `src/pages/adhoc/index.tsx`: 노드 확장 및 심층분석 기능 구현
- `src/components/adhoc/Graph.tsx`: 확장 가능한 노드 시각적 표시 추가

## 향후 개선사항

- [ ] 확장된 노드의 리스크 분석 결과 캐싱
- [ ] 확장 히스토리 관리 (되돌리기 기능)
- [ ] 배치 확장 기능 (여러 노드 동시 확장)
- [ ] 확장된 노드 수 제한 및 최적화
